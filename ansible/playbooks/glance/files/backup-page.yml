- name: Backup
  columns:
  - size: small
    widgets:
    - type: monitor
      title: Backup Services
      cache: 1m
      sites:
      - title: PBS Server
        url: https://192.168.20.50:8007
        icon: si:proxmox
        allow-insecure: true
      - title: Backup API
        url: http://192.168.40.13:9102/health
        icon: si:linux
    - type: custom-api
      title: Drive Health Status
      cache: 5m
      url: http://192.168.20.22:9101/health
      template: |
        <div style="padding: 10px;">
          {{ range .JSON.Array "drives" }}
          <div style="display: flex; align-items: center; justify-content: space-between; padding: 10px; margin-bottom: 8px; background: rgba(255,255,255,0.05); border-radius: 8px;">
            <div>
              <div style="font-weight: 600; color: #fff;">{{ .String "name" }}</div>
              <div style="font-size: 11px; color: #888;">{{ .String "datastore" }} datastore</div>
            </div>
            <div style="display: flex; align-items: center; gap: 8px;">
              {{ if .Bool "healthy" }}
              <span style="background: #22c55e; color: #fff; padding: 4px 10px; border-radius: 4px; font-size: 11px; font-weight: 600;">HEALTHY</span>
              {{ else }}
              <span style="background: #ef4444; color: #fff; padding: 4px 10px; border-radius: 4px; font-size: 11px; font-weight: 600;">FAILED</span>
              {{ end }}
            </div>
          </div>
          {{ end }}
        </div>
    - type: bookmarks
      title: Quick Links
      groups:
      - title: Backup Management
        links:
        - title: PBS Web UI
          url: https://192.168.20.50:8007
          icon: si:proxmox
        - title: Grafana Dashboard
          url: https://grafana.hrmsmrflrii.xyz/d/pbs-backup-status
          icon: si:grafana
  - size: full
    widgets:
    - type: custom-api
      title: Backup Jobs Overview
      cache: 5m
      url: http://192.168.40.13:9102/status
      template: |
        <div style="padding: 16px;">
          <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px; margin-bottom: 20px;">
            <!-- Daily Backups -->
            <div style="background: rgba(34, 197, 94, 0.08); border: 1px solid rgba(34, 197, 94, 0.3); border-radius: 12px; padding: 16px;">
              <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 12px;">
                <span style="font-size: 14px; color: #22c55e; font-weight: 700;">üì¶ DAILY BACKUPS</span>
                {{ if eq (.JSON.String "job_status.daily.status") "success" }}
                <span style="font-size: 11px; background: #22c55e; color: #000; padding: 4px 10px; border-radius: 6px; font-weight: 600;">OK</span>
                {{ else if eq (.JSON.String "job_status.daily.status") "stale" }}
                <span style="font-size: 11px; background: #f59e0b; color: #000; padding: 4px 10px; border-radius: 6px; font-weight: 600;">STALE</span>
                {{ else }}
                <span style="font-size: 11px; background: #666; color: #fff; padding: 4px 10px; border-radius: 6px; font-weight: 600;">N/A</span>
                {{ end }}
              </div>
              <div style="font-size: 18px; color: #fff; font-weight: 600; margin-bottom: 4px;">{{ .JSON.String "job_status.daily.last_backup" }}</div>
              <div style="display: flex; justify-content: space-between; margin-top: 12px;">
                <div>
                  <div style="font-size: 10px; color: #888; text-transform: uppercase;">Duration</div>
                  <div style="font-size: 16px; color: #22c55e; font-weight: 600;">{{ .JSON.String "job_status.daily.duration" }}</div>
                </div>
                <div style="text-align: right;">
                  <div style="font-size: 10px; color: #888; text-transform: uppercase;">Snapshots</div>
                  <div style="font-size: 16px; color: #fff; font-weight: 600;">{{ .JSON.Int "job_status.daily.count" }}</div>
                </div>
              </div>
            </div>
            <!-- Main Backups -->
            <div style="background: rgba(139, 92, 246, 0.08); border: 1px solid rgba(139, 92, 246, 0.3); border-radius: 12px; padding: 16px;">
              <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 12px;">
                <span style="font-size: 14px; color: #8b5cf6; font-weight: 700;">üóÑÔ∏è MAIN BACKUPS</span>
                {{ if eq (.JSON.String "job_status.main.status") "success" }}
                <span style="font-size: 11px; background: #22c55e; color: #000; padding: 4px 10px; border-radius: 6px; font-weight: 600;">OK</span>
                {{ else if eq (.JSON.String "job_status.main.status") "stale" }}
                <span style="font-size: 11px; background: #f59e0b; color: #000; padding: 4px 10px; border-radius: 6px; font-weight: 600;">STALE</span>
                {{ else }}
                <span style="font-size: 11px; background: #666; color: #fff; padding: 4px 10px; border-radius: 6px; font-weight: 600;">N/A</span>
                {{ end }}
              </div>
              <div style="font-size: 18px; color: #fff; font-weight: 600; margin-bottom: 4px;">{{ .JSON.String "job_status.main.last_backup" }}</div>
              <div style="display: flex; justify-content: space-between; margin-top: 12px;">
                <div>
                  <div style="font-size: 10px; color: #888; text-transform: uppercase;">Duration</div>
                  <div style="font-size: 16px; color: #8b5cf6; font-weight: 600;">{{ .JSON.String "job_status.main.duration" }}</div>
                </div>
                <div style="text-align: right;">
                  <div style="font-size: 10px; color: #888; text-transform: uppercase;">Snapshots</div>
                  <div style="font-size: 16px; color: #fff; font-weight: 600;">{{ .JSON.Int "job_status.main.count" }}</div>
                </div>
              </div>
            </div>
            <!-- NAS Sync -->
            <div style="background: rgba(59, 130, 246, 0.08); border: 1px solid rgba(59, 130, 246, 0.3); border-radius: 12px; padding: 16px;">
              <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 12px;">
                <span style="font-size: 14px; color: #3b82f6; font-weight: 700;">‚òÅÔ∏è NAS SYNC</span>
                {{ if eq (.JSON.String "status") "success" }}
                <span style="font-size: 11px; background: #22c55e; color: #000; padding: 4px 10px; border-radius: 6px; font-weight: 600;">OK</span>
                {{ else if eq (.JSON.String "status") "running" }}
                <span style="font-size: 11px; background: #3b82f6; color: #fff; padding: 4px 10px; border-radius: 6px; font-weight: 600;">RUNNING</span>
                {{ else }}
                <span style="font-size: 11px; background: #ef4444; color: #fff; padding: 4px 10px; border-radius: 6px; font-weight: 600;">ERROR</span>
                {{ end }}
              </div>
              <div style="font-size: 18px; color: #fff; font-weight: 600; margin-bottom: 4px;">{{ .JSON.String "last_sync" }}</div>
              <div style="display: flex; justify-content: space-between; margin-top: 12px;">
                <div>
                  <div style="font-size: 10px; color: #888; text-transform: uppercase;">Duration</div>
                  <div style="font-size: 16px; color: #3b82f6; font-weight: 600;">{{ .JSON.String "nas_sync_duration" }}</div>
                </div>
                <div style="text-align: right;">
                  <div style="font-size: 10px; color: #888; text-transform: uppercase;">NAS Storage</div>
                  <div style="font-size: 14px; color: #fff;">{{ .JSON.String "main_size" }} + {{ .JSON.String "daily_size" }}</div>
                </div>
              </div>
            </div>
          </div>
          <div style="font-size: 11px; color: #666; text-align: center;">
            Daily backups run at 1:00 AM ‚Ä¢ Main backups run weekly ‚Ä¢ NAS sync at 2:00 AM
          </div>
        </div>
    - type: custom-api
      title: VM & Container Backup Status
      cache: 10m
      url: http://192.168.40.13:9102/backups
      template: |
        <div style="padding: 16px;">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
            <span style="color: #22c55e; font-weight: 700; font-size: 16px;">{{ .JSON.Int "total_count" }} Protected VMs/Containers</span>
            <span style="font-size: 13px; color: #888;">{{ .JSON.Int "vm_count" }} VMs | {{ .JSON.Int "ct_count" }} CTs</span>
          </div>
          <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 10px; max-height: 500px; overflow-y: auto;">
            {{ range .JSON.Array "backups" }}
            <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px 16px; background: rgba(255,255,255,0.03); border-radius: 8px; border-left: 4px solid {{ if eq (.String "type") "VM" }}#3b82f6{{ else }}#f59e0b{{ end }};">
              <div style="display: flex; align-items: center; gap: 10px;">
                {{ if eq (.String "type") "VM" }}
                <span style="background: rgba(59,130,246,0.2); color: #3b82f6; padding: 3px 8px; border-radius: 4px; font-size: 10px; font-weight: 600;">VM</span>
                {{ else }}
                <span style="background: rgba(245,158,11,0.2); color: #f59e0b; padding: 3px 8px; border-radius: 4px; font-size: 10px; font-weight: 600;">CT</span>
                {{ end }}
                <div>
                  <div style="color: #fff; font-weight: 600; font-size: 13px;">{{ .String "name" }}</div>
                  <div style="color: #666; font-size: 11px;">ID: {{ .String "vmid" }}</div>
                </div>
              </div>
              <div style="text-align: right;">
                <div style="color: #fff; font-size: 13px;">{{ .String "last_backup" }}</div>
                <div style="color: #666; font-size: 10px;">{{ .String "datastore" }}</div>
              </div>
            </div>
            {{ end }}
          </div>
        </div>
    - type: iframe
      title: PBS Grafana Dashboard
      source: https://grafana.hrmsmrflrii.xyz/d/pbs-backup-status/pbs-backup-status?orgId=1&kiosk&theme=transparent&refresh=1m
      height: 1400
