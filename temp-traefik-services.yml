# Traefik Dynamic Configuration - hrmsmrflrii.xyz
# 26 Services with SSL via Let's Encrypt (includes Monitoring Stack)

http:
  routers:
    # ==========================================
    # TRAEFIK DASHBOARD
    # ==========================================
    traefik-dashboard:
      rule: "Host(`traefik.hrmsmrflrii.xyz`)"
      service: api@internal
      entryPoints:
        - websecure
      tls:
        certResolver: letsencrypt

    # ==========================================
    # PROXMOX NODES
    # ==========================================
    proxmox:
      rule: "Host(`proxmox.hrmsmrflrii.xyz`)"
      service: proxmox
      entryPoints:
        - websecure
      tls:
        certResolver: letsencrypt

    proxmox-node01:
      rule: "Host(`node01.hrmsmrflrii.xyz`)"
      service: proxmox-node01
      entryPoints:
        - websecure
      tls:
        certResolver: letsencrypt

    proxmox-node02:
      rule: "Host(`node02.hrmsmrflrii.xyz`)"
      service: proxmox-node02
      entryPoints:
        - websecure
      tls:
        certResolver: letsencrypt

    proxmox-node03:
      rule: "Host(`node03.hrmsmrflrii.xyz`)"
      service: proxmox-node03
      entryPoints:
        - websecure
      tls:
        certResolver: letsencrypt

    # ==========================================
    # CORE SERVICES
    # ==========================================
    authentik:
      rule: "Host(`auth.hrmsmrflrii.xyz`)"
      service: authentik
      entryPoints:
        - websecure
      tls:
        certResolver: letsencrypt

    immich:
      rule: "Host(`photos.hrmsmrflrii.xyz`)"
      service: immich
      entryPoints:
        - websecure
      tls:
        certResolver: letsencrypt

    gitlab:
      rule: "Host(`gitlab.hrmsmrflrii.xyz`)"
      service: gitlab
      entryPoints:
        - websecure
      tls:
        certResolver: letsencrypt

    # ==========================================
    # MEDIA SERVICES
    # ==========================================
    jellyfin:
      rule: "Host(`jellyfin.hrmsmrflrii.xyz`)"
      service: jellyfin
      entryPoints:
        - websecure
      tls:
        certResolver: letsencrypt

    radarr:
      rule: "Host(`radarr.hrmsmrflrii.xyz`)"
      service: radarr
      entryPoints:
        - websecure
      tls:
        certResolver: letsencrypt

    sonarr:
      rule: "Host(`sonarr.hrmsmrflrii.xyz`)"
      service: sonarr
      entryPoints:
        - websecure
      tls:
        certResolver: letsencrypt

    lidarr:
      rule: "Host(`lidarr.hrmsmrflrii.xyz`)"
      service: lidarr
      entryPoints:
        - websecure
      tls:
        certResolver: letsencrypt

    prowlarr:
      rule: "Host(`prowlarr.hrmsmrflrii.xyz`)"
      service: prowlarr
      entryPoints:
        - websecure
      tls:
        certResolver: letsencrypt

    bazarr:
      rule: "Host(`bazarr.hrmsmrflrii.xyz`)"
      service: bazarr
      entryPoints:
        - websecure
      tls:
        certResolver: letsencrypt

    overseerr:
      rule: "Host(`overseerr.hrmsmrflrii.xyz`)"
      service: overseerr
      entryPoints:
        - websecure
      tls:
        certResolver: letsencrypt

    jellyseerr:
      rule: "Host(`jellyseerr.hrmsmrflrii.xyz`)"
      service: jellyseerr
      entryPoints:
        - websecure
      tls:
        certResolver: letsencrypt

    tdarr:
      rule: "Host(`tdarr.hrmsmrflrii.xyz`)"
      service: tdarr
      entryPoints:
        - websecure
      tls:
        certResolver: letsencrypt

    autobrr:
      rule: "Host(`autobrr.hrmsmrflrii.xyz`)"
      service: autobrr
      entryPoints:
        - websecure
      tls:
        certResolver: letsencrypt

    # ==========================================
    # UTILITY SERVICES (docker-vm-utilities01)
    # ==========================================
    paperless:
      rule: "Host(`paperless.hrmsmrflrii.xyz`)"
      service: paperless
      entryPoints:
        - websecure
      tls:
        certResolver: letsencrypt

    glance:
      rule: "Host(`glance.hrmsmrflrii.xyz`)"
      service: glance
      entryPoints:
        - websecure
      tls:
        certResolver: letsencrypt

    n8n:
      rule: "Host(`n8n.hrmsmrflrii.xyz`)"
      service: n8n
      entryPoints:
        - websecure
      tls:
        certResolver: letsencrypt

    openspeedtest:
      rule: "Host(`speedtest.hrmsmrflrii.xyz`)"
      service: openspeedtest
      entryPoints:
        - websecure
      tls:
        certResolver: letsencrypt

    # ==========================================
    # MONITORING SERVICES (docker-vm-utilities01)
    # ==========================================
    uptime-kuma:
      rule: "Host(`uptime.hrmsmrflrii.xyz`)"
      service: uptime-kuma
      entryPoints:
        - websecure
      middlewares:
        - proxy-headers
      tls:
        certResolver: letsencrypt

    prometheus:
      rule: "Host(`prometheus.hrmsmrflrii.xyz`)"
      service: prometheus
      entryPoints:
        - websecure
      tls:
        certResolver: letsencrypt

    grafana:
      rule: "Host(`grafana.hrmsmrflrii.xyz`)"
      service: grafana
      entryPoints:
        - websecure
      tls:
        certResolver: letsencrypt

  # ==========================================
  # SERVICES (Backend Servers)
  # ==========================================
  services:
    # --- Proxmox Cluster ---
    proxmox:
      loadBalancer:
        servers:
          - url: "https://192.168.20.21:8006"
        serversTransport: insecure-transport

    proxmox-node01:
      loadBalancer:
        servers:
          - url: "https://192.168.20.20:8006"
        serversTransport: insecure-transport

    proxmox-node02:
      loadBalancer:
        servers:
          - url: "https://192.168.20.21:8006"
        serversTransport: insecure-transport

    proxmox-node03:
      loadBalancer:
        servers:
          - url: "https://192.168.20.22:8006"
        serversTransport: insecure-transport

    # --- Core Services ---
    authentik:
      loadBalancer:
        servers:
          - url: "http://192.168.40.21:9000"

    immich:
      loadBalancer:
        servers:
          - url: "http://192.168.40.22:2283"

    gitlab:
      loadBalancer:
        servers:
          - url: "http://192.168.40.23:80"

    # --- Media Services ---
    jellyfin:
      loadBalancer:
        servers:
          - url: "http://192.168.40.11:8096"

    radarr:
      loadBalancer:
        servers:
          - url: "http://192.168.40.11:7878"

    sonarr:
      loadBalancer:
        servers:
          - url: "http://192.168.40.11:8989"

    lidarr:
      loadBalancer:
        servers:
          - url: "http://192.168.40.11:8686"

    prowlarr:
      loadBalancer:
        servers:
          - url: "http://192.168.40.11:9696"

    bazarr:
      loadBalancer:
        servers:
          - url: "http://192.168.40.11:6767"

    overseerr:
      loadBalancer:
        servers:
          - url: "http://192.168.40.11:5055"

    jellyseerr:
      loadBalancer:
        servers:
          - url: "http://192.168.40.11:5056"

    tdarr:
      loadBalancer:
        servers:
          - url: "http://192.168.40.11:8265"

    autobrr:
      loadBalancer:
        servers:
          - url: "http://192.168.40.11:7474"

    # --- Utility Services ---
    paperless:
      loadBalancer:
        servers:
          - url: "http://192.168.40.10:8000"

    glance:
      loadBalancer:
        servers:
          - url: "http://192.168.40.10:8080"

    n8n:
      loadBalancer:
        servers:
          - url: "http://192.168.40.10:5678"

    openspeedtest:
      loadBalancer:
        servers:
          - url: "http://192.168.40.10:3000"

    # --- Monitoring Services ---
    uptime-kuma:
      loadBalancer:
        servers:
          - url: "http://192.168.40.10:3001"

    prometheus:
      loadBalancer:
        servers:
          - url: "http://192.168.40.10:9090"

    grafana:
      loadBalancer:
        servers:
          - url: "http://192.168.40.10:3030"

  # ==========================================
  # SERVERS TRANSPORTS
  # ==========================================
  serversTransports:
    insecure-transport:
      insecureSkipVerify: true

    # WebSocket transport for Socket.IO services (Uptime Kuma)
    websocket-transport:
      forwardingTimeouts:
        dialTimeout: 30s
        responseHeaderTimeout: 0s
        idleConnTimeout: 180s

  # ==========================================
  # MIDDLEWARES
  # ==========================================
  middlewares:
    secure-headers:
      headers:
        frameDeny: true
        browserXssFilter: true
        contentTypeNosniff: true
        stsSeconds: 31536000
        stsIncludeSubdomains: true
        stsPreload: true

    # Headers for services behind reverse proxy
    proxy-headers:
      headers:
        customRequestHeaders:
          X-Forwarded-Proto: "https"

# ==========================================
# TLS OPTIONS
# ==========================================
tls:
  options:
    default:
      minVersion: VersionTLS12
